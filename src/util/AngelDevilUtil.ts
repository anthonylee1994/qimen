import {地支, 天干} from "@/qimen/type";

export type 神煞 = "咸池" | "驛馬" | "孤辰" | "寡宿" | "將星" | "亡神" | "劫煞" | "災煞" | "白虎" | "華蓋" | "紅鸞" | "天喜";

export const angels: (神煞 | "貴人")[] = ["咸池", "驛馬", "將星", "紅鸞", "天喜", "貴人"];

export const devils: 神煞[] = ["孤辰", "寡宿", "亡神", "劫煞", "災煞", "白虎", "華蓋"];

export const 神煞表: Record<神煞, Record<地支, 地支>> = {
    咸池: {
        子: "酉",
        丑: "午",
        寅: "卯",
        卯: "子",
        辰: "酉",
        巳: "午",
        午: "卯",
        未: "子",
        申: "酉",
        酉: "午",
        戌: "卯",
        亥: "子",
    },
    將星: {
        子: "子",
        丑: "酉",
        寅: "午",
        卯: "卯",
        辰: "子",
        巳: "酉",
        午: "午",
        未: "卯",
        申: "子",
        酉: "酉",
        戌: "午",
        亥: "卯",
    },
    紅鸞: {
        子: "卯",
        丑: "寅",
        寅: "丑",
        卯: "子",
        辰: "亥",
        巳: "戌",
        午: "酉",
        未: "申",
        申: "未",
        酉: "午",
        戌: "巳",
        亥: "辰",
    },
    天喜: {
        子: "酉",
        丑: "申",
        寅: "未",
        卯: "午",
        辰: "巳",
        巳: "辰",
        午: "卯",
        未: "寅",
        申: "丑",
        酉: "子",
        戌: "亥",
        亥: "戌",
    },
    驛馬: {
        子: "寅",
        丑: "亥",
        寅: "申",
        卯: "巳",
        辰: "寅",
        巳: "亥",
        午: "申",
        未: "巳",
        申: "寅",
        酉: "亥",
        戌: "申",
        亥: "巳",
    },
    孤辰: {
        子: "寅",
        丑: "寅",
        寅: "巳",
        卯: "巳",
        辰: "巳",
        巳: "申",
        午: "申",
        未: "申",
        申: "亥",
        酉: "亥",
        戌: "亥",
        亥: "寅",
    },
    寡宿: {
        子: "戌",
        丑: "戌",
        寅: "丑",
        卯: "丑",
        辰: "丑",
        巳: "辰",
        午: "辰",
        未: "辰",
        申: "未",
        酉: "未",
        戌: "未",
        亥: "戌",
    },
    亡神: {
        子: "亥",
        丑: "申",
        寅: "巳",
        卯: "寅",
        辰: "亥",
        巳: "申",
        午: "巳",
        未: "寅",
        申: "亥",
        酉: "申",
        戌: "巳",
        亥: "寅",
    },
    劫煞: {
        子: "巳",
        丑: "寅",
        寅: "亥",
        卯: "申",
        辰: "巳",
        巳: "寅",
        午: "亥",
        未: "申",
        申: "巳",
        酉: "寅",
        戌: "亥",
        亥: "申",
    },
    災煞: {
        子: "午",
        丑: "卯",
        寅: "子",
        卯: "酉",
        辰: "午",
        巳: "卯",
        午: "子",
        未: "酉",
        申: "午",
        酉: "卯",
        戌: "子",
        亥: "酉",
    },
    白虎: {
        子: "申",
        丑: "酉",
        寅: "戌",
        卯: "亥",
        辰: "子",
        巳: "丑",
        午: "寅",
        未: "卯",
        申: "辰",
        酉: "巳",
        戌: "午",
        亥: "未",
    },
    華蓋: {
        子: "戌",
        丑: "丑",
        寅: "戌",
        卯: "未",
        辰: "戌",
        巳: "丑",
        午: "戌",
        未: "未",
        申: "戌",
        酉: "丑",
        戌: "戌",
        亥: "未",
    },
};

const 貴人表: Record<天干, 地支[]> = {
    甲: ["丑", "未"],
    戊: ["丑", "未"],
    庚: ["丑", "未"],
    乙: ["子", "申"],
    己: ["子", "申"],
    丙: ["亥", "酉"],
    丁: ["亥", "酉"],
    辛: ["午", "寅"],
    壬: ["卯", "巳"],
    癸: ["卯", "巳"],
};

export const AngelDevilUtil = Object.freeze({
    getAngelDevilMap: (時干: 天干, 時支: 地支): Record<地支, (神煞 | "貴人")[]> => {
        const angelDevils = Object.keys(神煞表) as (神煞 | "貴人")[];

        const angelDevilOf = (value: 地支): (神煞 | "貴人")[] => {
            return [...(貴人表[時干].includes(value) ? ["貴人"] : []), ...angelDevils.filter(name => 神煞表[name as 神煞][時支] === value)] as (神煞 | "貴人")[];
        };

        return {
            子: angelDevilOf("子"),
            丑: angelDevilOf("丑"),
            寅: angelDevilOf("寅"),
            卯: angelDevilOf("卯"),
            辰: angelDevilOf("辰"),
            巳: angelDevilOf("巳"),
            午: angelDevilOf("午"),
            未: angelDevilOf("未"),
            申: angelDevilOf("申"),
            酉: angelDevilOf("酉"),
            戌: angelDevilOf("戌"),
            亥: angelDevilOf("亥"),
        };
    },
    isAngel: (神煞: 神煞): boolean => {
        return angels.some(_ => 神煞.startsWith(_));
    },
    isDevil: (神煞: 神煞): boolean => {
        return devils.some(_ => 神煞.startsWith(_));
    },
});
